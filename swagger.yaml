openapi: 3.0.3
info:
  title: DGOVAL API (from Postman export)
  description: OpenAPI spec generated from Postman collection "dgoval export". Source Postman file included in conversation. :contentReference[oaicite:1]{index=1}
  version: "1.0.0"
servers:
  - url: "{{DGOVAL_BASE_URL}}"
    description: Base URL from Postman environment variable
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    SignupRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        hasAcceptedTerms:
          type: boolean
    SigninRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
    ResetPasswordRequest:
      type: object
      required:
        - email
        - newPassword
      properties:
        email:
          type: string
          format: email
        newPassword:
          type: string
    VerifyOtpRequest:
      type: object
      required:
        - email
        - otp
      properties:
        email:
          type: string
          format: email
        otp:
          type: string
    RefreshTokenResponse:
      type: object
      properties:
        accessToken:
          type: string
        expiresIn:
          type: integer
    PaymentConfirmRequest:
      type: object
      required:
        - paymentStatus
        - providerTxId
        - paymentId
      properties:
        paymentStatus:
          type: string
        providerTxId:
          type: string
        paymentId:
          type: string
    SelectPlanRequest:
      type: object
      required:
        - planId
        - companyId
        - userId
        - provider
      properties:
        planId:
          type: string
        companyId:
          type: string
        userId:
          type: string
        provider:
          type: string
    SurveyTemplateMetadata:
      type: object
      properties:
        companyId:
          type: string
        title:
          type: string
        description:
          type: string
    SurveyQuestions:
      type: object
      properties:
        companyId:
          type: string
        questions:
          type: array
          items:
            type: object
            properties:
              position:
                type: integer
              text:
                type: string
              type:
                type: string
              required:
                type: boolean
              skippable:
                type: boolean
              helpText:
                type: string
              likert:
                type: object
                properties:
                  scaleMinLabel:
                    type: string
                  scaleMaxLabel:
                    type: string
                  scalePoints:
                    type: integer
    CompanyCreateRequest:
      type: object
      required:
        - name
      properties:
        logoUrl:
          type: string
          format: uri
        name:
          type: string
        category:
          type: string
        industry:
          type: string
        address:
          type: string
        userId:
          type: string
paths:
  /auth/signup:
    post:
      summary: Sign up (register a new user)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
            example:
              email: "user@example.com"
              password: "securePassword123"
              firstName: "John"
              lastName: "Doe"
              hasAcceptedTerms: true
      responses:
        '201':
          description: Created - signup successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
  /auth/signin:
    post:
      summary: Sign in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SigninRequest'
            example:
              email: "caracolasstore@gmail.com"
              password: "Password@weq112"
      responses:
        '200':
          description: OK - returns auth tokens / session (implementation dependent)
  /auth/signout:
    post:
      summary: Sign out / revoke session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SigninRequest'
            example:
              email: "chidibede@gmail.com"
              password: "Password@weq112"
      responses:
        '200':
          description: OK
  /auth/forgot-password:
    post:
      summary: Request password reset (send OTP)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
            example:
              email: "caracolasstore@gmail.com"
      responses:
        '200':
          description: OK - OTP sent
  /auth/reset-password:
    post:
      summary: Reset password (after verifying OTP)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            example:
              email: "caracolasstore@gmail.com"
              newPassword: "Password@weq112"
      responses:
        '200':
          description: OK - password reset
  /auth/verify-reset-password:
    post:
      summary: Verify reset OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [otp, email]
              properties:
                otp:
                  type: string
                email:
                  type: string
            example:
              otp: "810226"
              email: "caracolasstore@gmail.com"
      responses:
        '200':
          description: OK - OTP verified
  /auth/verify-otp:
    post:
      summary: Verify account OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyOtpRequest'
            example:
              email: "chidimarshalbede@gmail.com"
              otp: "498906"
      responses:
        '200':
          description: OK
  /auth/resend-otp:
    post:
      summary: Resend OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
            example:
              email: "caracolasstore@gmail.com"
      responses:
        '200':
          description: OTP resent
  /auth/refresh-token:
    post:
      summary: Refresh access token using refresh token cookie
      parameters:
        - in: cookie
          name: refreshToken
          required: true
          schema:
            type: string
          description: Refresh token (cookie). Example shown in Postman headers.
      responses:
        '200':
          description: New access token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
  /api/payment/confirm:
    post:
      summary: Confirm payment success (webhook/callback style)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentConfirmRequest'
            example:
              paymentStatus: "succeeded"
              providerTxId: "6767998765444789765433"
              paymentId: "01K9DHPK9BDNGT0PTJ1Q1206CT"
      responses:
        '200':
          description: OK
  /api/payment/plans:
    get:
      summary: Fetch payment plans
      responses:
        '200':
          description: OK - list of plans
  /api/payment/plans/select:
    post:
      summary: Select payment plan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SelectPlanRequest'
            example:
              planId: "01K9C40J48F6YFQSGHF9JZG9JT"
              companyId: "01K9DHNRHY9CBXGTASXZH8B3AV"
              userId: "01K9DHJ3ZHRYPBNTQH3NQ5TZBK"
              provider: "Paystack"
      responses:
        '200':
          description: OK
  /api/surveys/templates/{templateId}/metadata:
    patch:
      summary: Update template metadata
      security:
        - bearerAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SurveyTemplateMetadata'
            example:
              companyId: "01K9DA5HM0406JZ1PP322VA1M8"
              title: "Executive Team Evaluation V2"
              description: "Used for internal assessment of executive performance V2"
      responses:
        '200':
          description: OK
  /api/surveys/templates/{templateId}/copy:
    post:
      summary: Copy/Duplicate template
      security:
        - bearerAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                companyId:
                  type: string
            example:
              companyId: "01K9DA5HM0406JZ1PP322VA1M8"
      responses:
        '200':
          description: OK - copy created
  /api/surveys/templates/{templateId}/questions:
    put:
      summary: Update template questions (replace)
      security:
        - bearerAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SurveyQuestions'
      responses:
        '200':
          description: OK
  /api/surveys/templates/{draftId}/autosave:
    put:
      summary: Auto-save template (similar body to update questions)
      security:
        - bearerAuth: []
      parameters:
        - name: draftId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SurveyQuestions'
      responses:
        '200':
          description: OK
  /api/surveys/templates/{draftId}/publish:
    post:
      summary: Publish template
      security:
        - bearerAuth: []
      parameters:
        - name: draftId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SurveyQuestions'
      responses:
        '200':
          description: OK - published
  /api/surveys/backoffice/templates:
    post:
      summary: Create survey template (backoffice)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SurveyQuestions'
      responses:
        '201':
          description: Created
    get:
      summary: List templates (backoffice) with pagination
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
        - in: query
          name: sort
          schema:
            type: string
        - in: query
          name: sortBy
          schema:
            type: string
      responses:
        '200':
          description: OK - paginated list
  /api/surveys/{companyId}/templates:
    get:
      summary: List all templates for selected company (or createdBy=me)
      security:
        - bearerAuth: []
      parameters:
        - name: companyId
          in: path
          required: true
          schema:
            type: string
        - in: query
          name: sortBy
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: sort
          schema:
            type: string
        - in: query
          name: createdBy
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/surveys/templates/{templateId}/versions:
    get:
      summary: List template versions
      security:
        - bearerAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/surveys/{templateId}/templates/details:
    get:
      summary: Get template details
      security:
        - bearerAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK - template details
  /api/surveys/templates/metadata:
    post:
      summary: Create survey template metadata
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SurveyTemplateMetadata'
      responses:
        '201':
          description: Created
  /api/companies/logo/upload:
    post:
      summary: Upload company logo (form-data file)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                logo:
                  type: string
                  format: binary
      responses:
        '200':
          description: OK - file uploaded
  /api/companies:
    post:
      summary: Create company
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyCreateRequest'
            example:
              logoUrl: "https://res.cloudinary.com/marshalcloudinary/image/upload/v1762257735/dgoval/20221114_161754-ecd4b9b6-7216-452e.jpg"
              name: "Access Trust bank"
              category: "Public"
              industry: "Banking"
              address: "Festac"
              userId: "01K9JCE76PWDEE18WADQDFZ82Z"
      responses:
        '201':
          description: Created
security:
  - {}
