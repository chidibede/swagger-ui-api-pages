openapi: 3.0.3
info:
  title: dgoval API
  version: 1.0.0
  description: |
    Consolidated OpenAPI specification for DGOVAL endpoints.
    This merges the provided docs and adds enumerations and standardized error responses.
servers:
  - url: http://{dgoval_base_url}
    variables:
      dgoval_base_url:
        default: localhost:3000
        description: Base URL for DGOVAL API
tags:
  - name: Auth
  - name: Payment
  - name: Companies
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: ""
        data:
          nullable: true
    ErrorResponse:
      type: object
      required: [success, code, message]
      properties:
        success:
          type: boolean
          example: false
        code:
          type: string
          description: Machine-readable error code
          example: VALIDATION_ERROR
        message:
          type: string
          description: Human-readable error description
          example: Invalid payment status or provider
        details:
          type: object
          additionalProperties: true
          description: Optional extra info (e.g., field errors)
    ValidationErrorDetails:
      type: object
      additionalProperties:
        type: array
        items:
          type: string
      example:
        paymentStatus: ["must be one of: succeeded, failed, cancelled"]
        provider: ["must be one of: Paystack, Flutterwave"]
    SignupRequest:
      type: object
      required: [email, password, firstName, lastName, hasAcceptedTerms]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          example: securePassword123
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        hasAcceptedTerms:
          type: boolean
          example: true
    SigninRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: caracolasstore@gmail.com
        password:
          type: string
          example: John@weq112
    ForgotPasswordRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
          example: caracolasstore@gmail.com
    ResetPasswordRequest:
      type: object
      required: [email, newPassword]
      properties:
        email:
          type: string
          format: email
          example: caracolasstore@gmail.com
        newPassword:
          type: string
          example: Password@weq112
    VerifyResetPasswordRequest:
      type: object
      required: [otp, email]
      properties:
        otp:
          type: string
          example: "301806"
        email:
          type: string
          format: email
          example: caracolasstore@gmail.com
    VerifyOtpRequest:
      type: object
      required: [email, otp]
      properties:
        email:
          type: string
          format: email
          example: caracolasstore@gmail.com
        otp:
          type: string
          example: "643577"
    Provider:
      type: string
      enum: [Paystack, Flutterwave]
      example: Paystack
    PaymentStatus:
      type: string
      enum: [succeeded, failed, cancelled]
      example: succeeded
    SelectPaymentPlanRequest:
      type: object
      required: [planId, companyId, userId, provider]
      properties:
        planId:
          type: string
          example: 01K97M4YDKY42QY9KYSJ8P183N
        companyId:
          type: string
          example: 01K9AFG1WHKVASTFNDVV8FVG3C
        userId:
          type: string
          example: 01K9AF8KBCWQB424ARNM0KQZD7
        provider:
          $ref: "#/components/schemas/Provider"
    ConfirmPaymentRequest:
      type: object
      required: [paymentStatus, provider, providerTxId, paymentId]
      properties:
        paymentStatus:
          $ref: "#/components/schemas/PaymentStatus"
        provider:
          $ref: "#/components/schemas/Provider"
        providerTxId:
          type: string
          description: Provider transaction reference/ID
          example: "6767998765444789765433"
        paymentId:
          type: string
          description: Internal payment record ID
          example: 01K9AFZ3YKWANH0H9C4JKJKS5B
    CreateCompanyRequest:
      type: object
      required: [logoUrl, name, category, industry, address, userId]
      properties:
        logoUrl:
          type: string
          format: uri
          example: https://res.cloudinary.com/marshalcloudinary/image/upload/v1762257735/dgoval/20221114_161754-ecd4b9b6-7216-452e-9d20-01e4dc10fecb.jpg
        name:
          type: string
          example: Guarantee Trust bank
        category:
          type: string
          example: Public
        industry:
          type: string
          example: Banking
        address:
          type: string
          example: Festac
        userId:
          type: string
          example: 01K9AF8KBCWQB424ARNM0KQZD7
  responses:
    Ok:
      description: OK
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ApiResponse"
    Created:
      description: Created
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ApiResponse"
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            allOf:
              - $ref: "#/components/schemas/ErrorResponse"
              - type: object
                properties:
                  code:
                    example: VALIDATION_ERROR
                  details:
                    $ref: "#/components/schemas/ValidationErrorDetails"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    TooManyRequests:
      description: Too Many Requests
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    ServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
paths:
  /auth/signup:
    post:
      tags: [Auth]
      summary: Sign up
      description: Register a new user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequest"
      responses:
        "201":
          $ref: "#/components/responses/Created"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/signin:
    post:
      tags: [Auth]
      summary: Sign in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SigninRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/signout:
    post:
      tags: [Auth]
      summary: Sign out
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/forgot-password:
    post:
      tags: [Auth]
      summary: Forgot password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/reset-password:
    post:
      tags: [Auth]
      summary: Reset password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/verify-reset-password:
    post:
      tags: [Auth]
      summary: Verify reset password OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyResetPasswordRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/verify-otp:
    post:
      tags: [Auth]
      summary: Verify email OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyOtpRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/ServerError"
  /auth/refresh-token:
    post:
      tags: [Auth]
      summary: Refresh access token
      description: Refreshes the access token using the refresh token (e.g. via HTTP-only cookie).
      parameters:
        - name: Cookie
          in: header
          description: Should contain `refreshToken=<JWT>` if using cookies
          required: false
          schema:
            type: string
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"
        "500":
          $ref: "#/components/responses/ServerError"
  /api/payment/plans:
    get:
      tags: [Payment]
      summary: Fetch payment plans
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 01K97M4YDKY42QY9KYSJ8P183N
                        plan_name:
                          type: string
                          example: month
                        amount:
                          type: integer
                          example: 100000
                        currency:
                          type: string
                          example: naira
                        interval:
                          type: string
                          example: monthly
        "500":
          $ref: "#/components/responses/ServerError"
  /api/payment/plans/select:
    post:
      tags: [Payment]
      summary: Select payment plan
      description: Start a payment flow for a selected plan and provider.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SelectPaymentPlanRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/ServerError"
  /api/payment/confirm:
    post:
      tags: [Payment]
      summary: Confirm a payment transaction
      description: Confirm the final outcome of a payment attempt.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConfirmPaymentRequest"
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/ServerError"
  /api/companies/logo/upload:
    post:
      tags: [Companies]
      summary: Upload company logo
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [logo]
              properties:
                logo:
                  type: string
                  format: binary
      responses:
        "200":
          $ref: "#/components/responses/Ok"
        "400":
          $ref: "#/components/responses/BadRequest"
        "413":
          description: Payload Too Large
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          $ref: "#/components/responses/ServerError"
  /api/companies:
    post:
      tags: [Companies]
      summary: Create company
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCompanyRequest"
      responses:
        "201":
          $ref: "#/components/responses/Created"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/ServerError"
    get:
      tags: [Companies]
      summary: List companies for current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 01K9AFG1WHKVASTFNDVV8FVG3C
                        name:
                          type: string
                          example: Guarantee Trust bank
                        category:
                          type: string
                          example: Public
                        industry:
                          type: string
                          example: Banking
                        address:
                          type: string
                          example: Festac
                        logoUrl:
                          type: string
                          format: uri
                        createdAt:
                          type: string
                          format: date-time
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/ServerError"
